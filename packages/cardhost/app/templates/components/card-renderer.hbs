{{#if @card}}
  {{#if (eq @format "isolated")}}
    <section
      class="card-renderer-isolated
        {{this.mode}}
        {{if @cardSelected "selected"}}
        {{if this.fields.length "has-fields" "no-fields"}}
        {{@class}}
      "
      tabindex="0"
      data-test-card-renderer-isolated
      {{on "focus" (action this.cardIsFocused true)}}
      {{did-insert this.focusCard true}}
      {{did-update this.cardUpdated @card}}
    >
      {{#if (eq @mode "view")}}
        {{#animated-value @card watch="isSelected" use=this.headerAnimation}}
          <div class="card-renderer-isolated--header--wrapper {{if @cardSelected "selected"}}">
            <header class="card-renderer-isolated--header">
              <span class="card-renderer-isolated--header-title hide-in-percy">{{or @card.csTitle "Blank Card"}}</span>
              {{#if this.cardstackSession.isAuthenticated}}
                <LinkTo
                  @route="cards.card-v2.edit.fields"
                  @model={{@card.canonicalURL}}
                  @class="card-renderer--header-link"
                  data-test-card-edit-link
                >
                  Edit
                </LinkTo>
              {{/if}}
            </header>
          </div>
        {{/animated-value}}
      {{else}}
        <div class="card-renderer-isolated--header--wrapper">
          <header class="card-renderer-isolated--header">
            <span class="card-renderer-isolated--header-title hide-in-percy">{{or @card.csTitle "Blank Card"}}</span>
            {{#if (eq @mode "edit")}}
              {{!-- disabling this while we are working out the models
              <LinkTo
                @route="cards.card.view"
                @model={{@card}}
                @class="card-renderer--header-link"
                data-test-card-done-link
              >
                Done
              </LinkTo>
              --}}
              {{!-- this is a placeholder link --}}
              <a class="card-renderer--header-link">Done</a>
            {{/if}}
          </header>
        </div>
      {{/if}}
      {{!-- This is the card boundary, please don't set any card specific classes any higher in the DOM than this. --}}
      {{!-- If we need card specific styling above this level, then let's chat about it.                           --}}
      <div class="card-renderer-isolated--content
        {{concat (safe-css-string (if @card.canonicalURL @card.canonicalURL @card.adoptsFromURL)) "--isolated" }}
      ">
        <AnimatedContainer>
          {{#animated-value @card watch="isSelected" use=this.borderAnimation}}
            <div class="card-renderer-isolated--card-container {{if @cardSelected "selected"}}">
              {{#if (and @dropField ) }}
                <DropZone
                  @dropField={{@dropField}}
                  @position={{0}}
                  @toggleStubField={{this.toggleStubField}}
                />
              {{/if}}
              <Scaffold
                @card={{@card}}
                @feature="isolated-layout"
                @fields={{this.fields}}
                @mode={{this.mode}}
                @setFieldName={{@setFieldName}}
                @setCardValue={{@setCardValue}}
                @setCardReference={{@setCardReference}}
                @removeField={{@removeField}}
                @toggleStubField={{this.toggleStubField}}
                @setNeededWhenEmbedded={{@setNeededWhenEmbedded}}
                @setPosition={{@setPosition}}
                @selectField={{@selectField}}
                @selectedField={{@selectedField}}
                @selectedFieldName={{@selectedFieldName}}
                @dropField={{@dropField}} />
            </div>
          {{/animated-value}}
        </AnimatedContainer>
      </div>
    </section>
  {{else if (eq @format "embedded")}}
    <div class="card-renderer-embedded
        {{concat (safe-css-string (if @card.canonicalURL @card.canonicalURL @card.adoptsFromURL)) "--embedded" }}"
      data-test-card-renderer-embedded
    >
      {{#if (and (eq this.mode "view") (not @preventIsolation))}}
        {{!-- disabling this while we are working out the models
        <LinkTo
          @class="card-renderer--embedded-card-link"
          @route="cards.card.view"
          @model={{@card.csTitle}}
          aria-label={{@card.csTitle}}
        >
        --}}
        {{!-- this is a placeholder link --}}
        <a class="card-renderer--embedded-card-link">
          <Scaffold
            @card={{@card}}
            @feature="embedded-layout"
            @mode={{this.mode}} />
          {{#if @showName}}
            <div class="embedded-card-label">{{@card.csTitle}}</div>
          {{/if}}
        </a>
        {{!-- disabling this while we are working out the models
        </LinkTo>
        --}}
      {{else}}
        <Scaffold
          @card={{@card}}
          @feature="embedded-layout"
          @mode={{this.mode}} />
        {{#if @showName}}
          <div class="embedded-card-label">{{@card.csTitle}}</div>
        {{/if}}
      {{/if}}
    </div>
  {{/if}}
{{/if}}