<h2 data-test-card-creator>Add Card</h2>

{{#if this.statusMsg}}
  <div data-test-card-creator-msg><strong>{{this.statusMsg}}</strong></div>
{{/if}}

<fieldset class="card-creator--new-card">
  <legend>New Card</legend>
  <label for="card__id">Card ID:</label>
  <Input
    @id="card__id"
    @size="60"
    @placeholder="e.g. local-hub::article-card::millenial-puppies"
    @value={{this.cardId}}
    @key-up={{action this.updateCardId}}
  />
  <p>(Note that updating the card id will remove any fields that you have created. This is just a scaffolding limitation.)</p>
</fieldset>

<br>

{{#if this.card}}
  <div class="card-manipulator--container">
    {{!-- Left edge --}}
    <div class="card-manipulator--left-edge">
      {{!-- Profile sidebar --}}
      <div class="card-manipulator--left-edge--profile">
        <div class="profile icon"></div>
        <div class="settings icon active"></div>
        <div class="search icon"></div>
      </div>
      {{!-- Catalog fields list --}}
      <div class="card-manipulator--left-edge--catalog">
        <div class="title">Card Catalog</div>

        {{#each this.fieldComponents as |field|}}
          {{! eslint is confused by on helper }}
          {{! template-lint-disable attribute-indentation}}
          <div
            class="card-manipulator--left-edge--catalog-field"
            role="button"
            draggable="true"
            {{on "mousedown" (action this.beginDragging field)}}
            {{on "dragend" (action (mut this.isDragging) false)}}
            data-test-card-add-field-draggable={{field.type}}
          >
            {{! template-lint-disable no-inline-styles}}
            <div class="field-icon" style={{css-url "background-image" field.icon}}></div>
            <div class="field-content">
              <div class="field-content--title">{{field.title}}</div>
              <div class="field-content--description">{{field.description}}</div>
              <div class="field-content--type">Type: <code>{{field.type}}</code></div>
              <div class="field-content--info-icon"></div>
            </div>
          </div>
        {{/each}}
      </div>
    </div>
    <div class="card-manipulator--main">
      {{!-- Card --}}
      <div class="card-manipulator--card">
        <div class="card-manipulator--card-header">
          <div class="title">New Card</div>
          <code class="id">{{@card.id}}</code>
          {{#unless this.cardstackSession.isAuthenticated}}
            (Must be logged in to save the card.)
          {{/unless}}
          {{! eslint is confused by on helper }}
          {{! template-lint-disable attribute-indentation}}
          <button
            {{on "click" this.save}}
            class="done-btn"
            data-test-card-creator-save-btn
            disabled={{not this.cardstackSession.isAuthenticated}}
          >
            Save Card
          </button>
        </div>
        <CardRenderer
          @card={{this.card}}
          @format="isolated"
          @mode="schema"
          @removeField={{action this.removeField}}
          @setPosition={{action this.setPosition}}
          @selectField={{action this.selectField}}
        >

          {{! eslint is confused by on helper }}
          {{! template-lint-disable attribute-indentation}}
          <div
            class="card-manipulator--card--field--drop-zone"
            role="button"
            {{on "drop" (action this.dropField)}}
            {{on "dragover" (action this.dragOver)}}
            {{on "dragenter" (action (mut this.isOverDropZone) true)}}
            {{on "dragleave" (action (mut this.isOverDropZone) false)}}
            data-test-card-add-field-drop-zone
          >
            Drop fields here to edit/add
          </div>

        </CardRenderer>
      </div>
    </div>
    <div class="card-manipulator--right-edge">
      <div class="card-manipulator--right-edge--field">
        <div class="card-manipulator--right-edge--field-header">
          Edit Field Schema
        </div>
        {{#if this.selectedField}}
          <FieldRenderer
            @field={{this.selectedField}}
            @mode="schema"
            @position={{this.selectedField.position}}
            @setNeededWhenEmbedded={{action this.setNeededWhenEmbedded}}
            @setFieldName={{action this.setFieldName}}
            @setPosition={{action this.setPosition}}
          />
        {{/if}}
      </div>
    </div>
  </div>
{{/if}}

<br>

{{#if this.card}}
  <h3>Card Document:</h3>
  <CodeBlock
    @code={{this.cardJson}}
    @language="javascript"
  />
{{/if}}